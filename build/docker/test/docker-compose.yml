version: "3.0"
services:
  mysql:
    image: "mysql:5.7"
    container_name: "vinyldns-mysql"
    environment:
      MYSQL_ROOT_PASSWORD: 'pass'
      MYSQL_ROOT_HOST: '%'
    container_name: "vinyldns-mysql"
    ports:
      - "19002:3306"

#  bind9:
#    image: "vinyldns/test-bind9:${VINYLDNS_VERSION}"
#    container_name: "vinyldns-bind9"
#    ports:
#      - "19001:53/udp"
#      - "19001:53"

  api:
    image: "vinyldns/api:${VINYLDNS_VERSION}"
    container_name: "vinyldns-api"
    env_file:
      .env
    environment:
      MYSQL_ROOT_PASSWORD: 'pass'
      MYSQL_ROOT_HOST: '%'
    ports:
      - "9000:9000"
    volumes:
      - ./docker.conf:/opt/docker/conf/application.conf
    depends_on:
      - mysql

  ldap:
    image: rroemhild/test-openldap
    container_name: "vinyldns-ldap"
    ports:
      - "19008:389"

  portal:
    image: "vinyldns/portal:${VINYLDNS_VERSION}"
    container_name: "vinyldns-portal"
    env_file:
      .env
    ports:
      - "9001:9000"
    volumes:
      - ./portal.conf:/opt/docker/conf/application.conf
    depends_on:
      - api
      - ldap

#  functest:
#    image: "vinyldns/functest:${VINYLDNS_VERSION}"
#    env_file:
#      .env
#    environment:
#      TEST_PATTERN: 'verify_production'
#      PROD_ENV: 'true'
#    container_name: "vinyldns-functest"
#    depends_on:
#      - api